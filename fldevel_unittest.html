<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.13"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>Falaise: Unit Testing for Falaise using Catch</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectalign" style="padding-left: 0.5em;">
   <div id="projectname">Falaise
   &#160;<span id="projectnumber">3.0.0</span>
   </div>
   <div id="projectbrief">SuperNEMO Software Toolkit</div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.13 -->
<script type="text/javascript">
var searchBox = new SearchBox("searchBox", "search",false,'Search');
</script>
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
$(function() {
  initMenu('',true,false,'search.php','Search');
  $(document).ready(function() { init_search(); });
});
</script>
<div id="main-nav"></div>
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

</div><!-- top -->
<div class="header">
  <div class="headertitle">
<div class="title">Unit Testing for Falaise using Catch </div>  </div>
</div><!--header-->
<div class="contents">
<div class="toc"><h3>Table of Contents</h3>
<ul><li class="level1"><a href="#fldevel_unittest_intro">Introduction </a></li>
<li class="level1"><a href="#fldevel_unittest_writing">Writing Catch-based Unit Tests for Falaise </a></li>
<li class="level1"><a href="#fldevel_unittest_integrating">Integrating Tests into Falaise&#39;s Testing System </a><ul><li class="level2"><a href="#fldevel_unittest_integrating_library">Integrating Core `libFalaise` Tests </a></li>
<li class="level2"><a href="#fldevel_unittest_integrating_modules">Integrating Core Plugin Module Tests </a></li>
</ul>
</li>
<li class="level1"><a href="#fldevel_unittest_running">Running Falaise&#39;s Tests with CMake/CTest </a></li>
</ul>
</div>
<div class="textblock"><h1><a class="anchor" id="fldevel_unittest_intro"></a>
Introduction </h1>
<p>All functions and classes within Falaise must have accompanying unit tests that exercise and verify the specifications of their interfaces. To help developers easily write and run tests, Falaise uses the <a href="https://github.com/philsquared/Catch">Catch</a> framework for authoring C++ tests, and the <a href="https://cmake.org/cmake/help/v3.3/manual/ctest.1.html">CTest</a> component of CMake to run them.</p>
<p>To enable the build and running of tests in Falaise, the CMake variable <code>FALAISE_ENABLE_TESTING</code> must be set to <code>ON</code>. This may be done on the command line via a <code>-D</code> argument to CMake or through the Curses/GUI CMake interfaces. It can be set/unset either on the initial configuration, or in subsequent reconfigurations.</p>
<h1><a class="anchor" id="fldevel_unittest_writing"></a>
Writing Catch-based Unit Tests for Falaise </h1>
<p>We defer documentation on writing unit tests with Catch to the comprehensive <a href="https://github.com/philsquared/Catch/blob/master/docs/tutorial.md">Tutorial</a> and <a href="https://github.com/philsquared/Catch/tree/master/docs">Reference Guides</a> available on Catch's github site. However, there are a couple of coding and structure issues to be aware of to ensure your tests integrate easily with Falaise.</p>
<p>To speed up compile times, Falaise precompiles a main program for Catch into the <code>FLCatch</code> static library that is linked to tests together with the <code>Falaise</code> library itself. The structure of Falaise's Catch tests thus only requires inclusion of the Catch header, and the <code>CATCH_CONFIG_MAIN</code> macro should <em>not</em> be defined. Therefore most tests should take the form:</p>
<div class="fragment"><div class="line"><span class="preprocessor">#include &quot;catch.hpp&quot;</span>   <span class="comment">// Just the Catch API</span></div><div class="line"></div><div class="line"><span class="preprocessor">#include &quot;falaise/mymodule/myinterfacetotest.h&quot;</span>    <span class="comment">// Declaration(s) for what needs testing</span></div><div class="line"></div><div class="line">TEST_CASE(<span class="stringliteral">&quot;Test myinterface&quot;</span>, <span class="stringliteral">&quot;[falaise][mymodule]&quot;</span>) {</div><div class="line">...</div><div class="line">}</div></div><!-- fragment --><p>As shown in the above example, you should also use Catch's <a href="https://github.com/philsquared/Catch/blob/master/docs/test-cases-and-sections.md#tags">Tags facility</a> to name cases according to the submodule they are part of the aspect of the interface they are testing.</p>
<p>BY default, the <code>main</code> program built for Catch testing does not run any of Falaise's setup/teardown functions for self-location. If your tests require this functionality, you should add the calls at the start/end of your test cases as needed, e.g.</p>
<div class="fragment"><div class="line">TEST_CASE(<span class="stringliteral">&quot;Test resources&quot;</span>, <span class="stringliteral">&quot;[falaise][mymodule]&quot;</span>) {</div><div class="line">  <a class="code" href="namespacefalaise.html#a5e165123329093c61d84e302b155dc7d">falaise::initialize</a>();</div><div class="line">  ...</div><div class="line"></div><div class="line">  <a class="code" href="namespacefalaise.html#a0663125a6212b3951a484208233b3365">falaise::terminate</a>();</div><div class="line">}</div></div><!-- fragment --><p>Addition of the calls to Falaise's Catch-main program is being reviewed.</p>
<h1><a class="anchor" id="fldevel_unittest_integrating"></a>
Integrating Tests into Falaise's Testing System </h1>
<h2><a class="anchor" id="fldevel_unittest_integrating_library"></a>
Integrating Core `libFalaise` Tests </h2>
<p>To let Falaise know about your Catch-based tests, simply add the file to the list of Catch tests declared for the module in its <code>.cmake</code> file located in <code>source/falaise</code> (e.g. <code>source/falaise/snemo.cmake</code>) In the transition to full Catch based tests, Falaise modules need to define two variables to list source files for tests, as shown in the following example:</p>
<div class="fragment"><div class="line">... the &quot;flmymodule_module.cmake&quot; file...</div><div class="line"></div><div class="line"># List old, non-Catch tests in this variable</div><div class="line">set(FalaiseLibrary_TESTS</div><div class="line">  ...</div><div class="line">  test_myoldtest.cxx</div><div class="line">  ..</div><div class="line">  )</div><div class="line"></div><div class="line"># List new Catch based tests in this one</div><div class="line">set(FalaiseLibrary_TESTS_CATCH</div><div class="line">  ...</div><div class="line">  test_myinterfacetest.cxx</div><div class="line">  ...</div><div class="line">  )</div></div><!-- fragment --><p>As you migrate your tests to Catch, simply move the file from the old list to the new. Falaise's CMake system will automatically pick up the test lists and compile test programs for them named <code>falaise-&lt;sourcefilename&gt;</code>. All test executables are output to the <code>BuildProducts/bin/fltests</code> subdirectory of Falaise's build directory.</p>
<p>Falaise's CMake system will take care of the compilation and addition of the executables to the testing system.</p>
<h2><a class="anchor" id="fldevel_unittest_integrating_modules"></a>
Integrating Core Plugin Module Tests </h2>
<p>If your plugin module is a core module, i.e. located under a <code>modules/yourplugin</code> directory in the source tree of Falaise, then Catch may also be used for testing. You can write your tests exactly as described above using the catch guides, but to add them into the testing system a few lines are needed in your CMake script. Say you have source code for your tests in a file <code>test_myplugin_someclass.cxx</code>, then to compile this into a test to be run, add the following commands to the CMake script that builds it:</p>
<div class="fragment"><div class="line"># Assumes this script is at the same directory level as the source file...</div><div class="line"></div><div class="line"># Build the executable</div><div class="line">add_executable(falaise-test_myplugin_someclass test_myplugin_someclass.cxx)</div><div class="line"></div><div class="line"># Link it to Falaise and the Catch library that supplies main()</div><div class="line">target_link_libraries(falaise-test_myplugin_someclass Falaise FLCatch)</div><div class="line"></div><div class="line"># Declare the test to CTest so that the executable is run as part of testing</div><div class="line">add_test(NAME falaise-test_myplugin_someclass </div><div class="line">  COMMAND falaise-test_myplugin_someclass</div><div class="line">  )</div><div class="line"></div><div class="line"># Output the test executable to the dedicated binary directory for module tests</div><div class="line">set_target_properties(${_testname}</div><div class="line">  PROPERTIES</div><div class="line">    RUNTIME_OUTPUT_DIRECTORY ${CMAKE_RUNTIME_OUTPUT_DIRECTORY}/fltests/modules</div><div class="line">  )</div></div><!-- fragment --><p>The test will be run as part of the standard CTest run, and you free to set additional properties on the test as your use case demands.</p>
<h1><a class="anchor" id="fldevel_unittest_running"></a>
Running Falaise's Tests with CMake/CTest </h1>
<p>When Falaise's testing is enabled, CMake will build the executables and add them to the tests known by CTest. There are three main ways to run the tests after building Falaise itself.</p>
<p>CMake will create a target in the buildtool that can be "built" to run all the tests and report their success/failure. For single mode tools like Make and Ninja this is the <code>test</code> target, which may be "built" by:</p>
<div class="fragment"><div class="line">$ make test</div></div><!-- fragment --><p>or</p>
<div class="fragment"><div class="line">$ ninja test</div></div><!-- fragment --><p>In IDEs like Xcode, a new build spec/template is created, usually named "RUN_TEST" or similar. This may be built/run using the tools in the IDE.</p>
<p>The second way to run tests, independent of the buildtool, is to run CMake's <a href="https://cmake.org/cmake/help/v3.3/manual/ctest.1.html"><code>ctest</code> executable</a> directly in Falaise's build directory. This is useful if you find tests are failing and wish to run individual tests to inspect the failures in detail. Please consult the <a href="https://cmake.org/cmake/help/v3.3/manual/ctest.1.html">ctest manual</a> for full details on the command line options to select individual tests and verbosity levels.</p>
<p>Finally, the test programs are fully functional command line executables, so may be run directly. Tests with a Catch supplied main provide a command line interface for listing and working with individual test cases in the program. Simply run</p>
<div class="fragment"><div class="line">$ ./BuildProducts/bin/fltests/&lt;testname&gt; --help</div></div><!-- fragment --><p>for a list of options. </p>
</div></div><!-- contents -->
<!-- start footer part -->
<hr class="footer"/><address class="footer"><small>
Generated by &#160;<a href="http://www.doxygen.org/index.html">
<img class="footer" src="doxygen.png" alt="doxygen"/>
</a> 1.8.13
</small></address>
</body>
</html>
