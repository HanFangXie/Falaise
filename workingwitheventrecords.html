<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "https://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.15"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>Falaise: Working With Events in FLReconstruct</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectalign" style="padding-left: 0.5em;">
   <div id="projectname">Falaise
   &#160;<span id="projectnumber">4.0.1</span>
   </div>
   <div id="projectbrief">SuperNEMO Software Toolkit</div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.15 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
var searchBox = new SearchBox("searchBox", "search",false,'Search');
/* @license-end */
</script>
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
$(function() {
  initMenu('',true,false,'search.php','Search');
  $(document).ready(function() { init_search(); });
});
/* @license-end */</script>
<div id="main-nav"></div>
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

</div><!-- top -->
<div class="PageDoc"><div class="header">
  <div class="headertitle">
<div class="title">Working With Events in FLReconstruct </div>  </div>
</div><!--header-->
<div class="contents">
<div class="textblock"><h1><a class="anchor" id="workingwitheventrecords_introduction"></a>
Introduction to Event Data </h1>
<p>Events in <code>flreconstruct</code> are represented by instances of the <a class="elRef" doxygen="https://supernemo-dbd.github.io/Bayeux/bayeux.doxy.tag:https://supernemo-dbd.github.io/Bayeux/" href="https://supernemo-dbd.github.io/Bayeux/classdatatools_1_1things.html">datatools::things</a> class. The <code>process</code> member function of pipeline modules is passed a non-const is called for each event, and is passed a <a class="elRef" doxygen="https://supernemo-dbd.github.io/Bayeux/bayeux.doxy.tag:https://supernemo-dbd.github.io/Bayeux/" href="https://supernemo-dbd.github.io/Bayeux/classdatatools_1_1things.html">datatools::things</a> reference to the current event.</p>
<p>The <a class="elRef" doxygen="https://supernemo-dbd.github.io/Bayeux/bayeux.doxy.tag:https://supernemo-dbd.github.io/Bayeux/" href="https://supernemo-dbd.github.io/Bayeux/classdatatools_1_1things.html">datatools::things</a> class is nothing more than a key-value dictionary with <code>std::string</code> keys pointing to objects representing different parts of the event data. Each data model object is a class inheriting from <a class="elRef" doxygen="https://supernemo-dbd.github.io/Bayeux/bayeux.doxy.tag:https://supernemo-dbd.github.io/Bayeux/" href="https://supernemo-dbd.github.io/Bayeux/classdatatools_1_1i__serializable.html">datatools::i_serializable</a>, allowing many different concrete data models to be stored. As <code><a class="elRef" doxygen="https://supernemo-dbd.github.io/Bayeux/bayeux.doxy.tag:https://supernemo-dbd.github.io/Bayeux/" href="https://supernemo-dbd.github.io/Bayeux/classdatatools_1_1things.html">datatools::things</a></code> itself inherits from <code><a class="elRef" doxygen="https://supernemo-dbd.github.io/Bayeux/bayeux.doxy.tag:https://supernemo-dbd.github.io/Bayeux/" href="https://supernemo-dbd.github.io/Bayeux/classdatatools_1_1i__serializable.html">datatools::i_serializable</a></code>, it is capable of storing other <code><a class="elRef" doxygen="https://supernemo-dbd.github.io/Bayeux/bayeux.doxy.tag:https://supernemo-dbd.github.io/Bayeux/" href="https://supernemo-dbd.github.io/Bayeux/classdatatools_1_1things.html">datatools::things</a></code> instances, allowing a tree-like structure of data if required.</p>
<p>In this tutorial, we'll look at three basic aspects of working with <a class="elRef" doxygen="https://supernemo-dbd.github.io/Bayeux/bayeux.doxy.tag:https://supernemo-dbd.github.io/Bayeux/" href="https://supernemo-dbd.github.io/Bayeux/classdatatools_1_1things.html">datatools::things</a> instances provided to the <code>process</code> method of your custom pipeline module,</p>
<ol type="1">
<li>Reading data from the <a class="elRef" doxygen="https://supernemo-dbd.github.io/Bayeux/bayeux.doxy.tag:https://supernemo-dbd.github.io/Bayeux/" href="https://supernemo-dbd.github.io/Bayeux/classdatatools_1_1things.html">datatools::things</a> instance</li>
<li>Writing builtin objects to the instance</li>
<li>(DEPRECATED) Implementing custom objects for storage in <a class="elRef" doxygen="https://supernemo-dbd.github.io/Bayeux/bayeux.doxy.tag:https://supernemo-dbd.github.io/Bayeux/" href="https://supernemo-dbd.github.io/Bayeux/classdatatools_1_1things.html">datatools::things</a></li>
</ol>
<h1><a class="anchor" id="workingwitheventrecords_things_readingdata"></a>
Reading Event Data </h1>
<p>To work with events in the pipeline we first need to implement a pipeline module to do this. The basics of how to do this are covered in <a class="el" href="writingflreconstructmodules.html">a dedicated tutorial</a> and you should familiarize yourself with this material as this tutorial will build on it.</p>
<p>First of all we implement our module, build it and write a pipeline script to use it in <code>flreconstruct</code>. Note that we have stripped all comments except those relating to the process methods, and that the module takes no configuration. If you require details on how to implement a basic flreconstruct method, please refer to the <a class="el" href="writingflreconstructmodules.html">introductory tutorial</a> first.</p>
<div class="fragment"><div class="line"><span class="comment">// Interface from Falaise</span></div><div class="line"><span class="preprocessor">#include &quot;<a class="code" href="module_8h.html">falaise/snemo/processing/module.h</a>&quot;</span></div><div class="line"></div><div class="line"><span class="comment">// Any data models we need</span></div><div class="line"><span class="preprocessor">#include &lt;<a class="codeRef" doxygen="https://supernemo-dbd.github.io/Bayeux/bayeux.doxy.tag:https://supernemo-dbd.github.io/Bayeux/" href="https://supernemo-dbd.github.io/Bayeux/simulated__data_8h.html">bayeux/mctools/simulated_data.h</a>&gt;</span></div><div class="line"></div><div class="line"><span class="keyword">class </span>AccessThingsModule {</div><div class="line"> <span class="keyword">public</span>:</div><div class="line">  AccessThingsModule() = <span class="keywordflow">default</span>;</div><div class="line"></div><div class="line">  AccessThingsModule(<a class="code" href="classfalaise_1_1config_1_1property__set.html">falaise::config::property_set</a> <span class="keyword">const</span>&amp; <span class="comment">/*ps*/</span>,</div><div class="line">           <a class="codeRef" doxygen="https://supernemo-dbd.github.io/Bayeux/bayeux.doxy.tag:https://supernemo-dbd.github.io/Bayeux/" href="https://supernemo-dbd.github.io/Bayeux/classdatatools_1_1service__manager.html">datatools::service_manager</a>&amp; <span class="comment">/*services*/</span>) {</div><div class="line">  }</div><div class="line"></div><div class="line">  <span class="comment">// Process event</span></div><div class="line">  <a class="codeRef" doxygen="https://supernemo-dbd.github.io/Bayeux/bayeux.doxy.tag:https://supernemo-dbd.github.io/Bayeux/" href="https://supernemo-dbd.github.io/Bayeux/classdpp_1_1base__module.html#ae8431b8f4f2734bae557791b9f5417fb">falaise::processing::status</a> process(<a class="codeRef" doxygen="https://supernemo-dbd.github.io/Bayeux/bayeux.doxy.tag:https://supernemo-dbd.github.io/Bayeux/" href="https://supernemo-dbd.github.io/Bayeux/classdatatools_1_1things.html">datatools::things</a>&amp; event) {</div><div class="line">    <span class="comment">// Print most basic information</span></div><div class="line">    std::cout &lt;&lt; <span class="stringliteral">&quot;AccessThingsModule::process called!&quot;</span> &lt;&lt; std::endl;</div><div class="line">    std::cout &lt;&lt; <span class="stringliteral">&quot;[name]        : &quot;</span> &lt;&lt; <span class="keyword">event</span>.get_name() &lt;&lt; std::endl;</div><div class="line">    std::cout &lt;&lt; <span class="stringliteral">&quot;[description] : &quot;</span> &lt;&lt; <span class="keyword">event</span>.get_description() &lt;&lt; std::endl;</div><div class="line"></div><div class="line">    <span class="comment">// Extract list of keys stored by the object</span></div><div class="line">    std::vector&lt;std::string&gt; keys;</div><div class="line">    <span class="keyword">event</span>.get_names(keys);</div><div class="line"></div><div class="line">    <span class="comment">// Print each key and its concrete type</span></div><div class="line">    <span class="keywordflow">for</span> (<span class="keyword">const</span> <span class="keyword">auto</span>&amp; k : keys) {</div><div class="line">      std::cout &lt;&lt; <span class="stringliteral">&quot;- [key, serial_tag] : &quot;</span></div><div class="line">          &lt;&lt; k</div><div class="line">          &lt;&lt; <span class="stringliteral">&quot;, &quot;</span></div><div class="line">          &lt;&lt; <span class="keyword">event</span>.get_entry_serial_tag(k)</div><div class="line">          &lt;&lt; std::endl;</div><div class="line">    }</div><div class="line"></div><div class="line">    <span class="comment">// Grab simulated data bank</span></div><div class="line">    <span class="keyword">auto</span>&amp; simData = <span class="keyword">event</span>.get&lt;<a class="codeRef" doxygen="https://supernemo-dbd.github.io/Bayeux/bayeux.doxy.tag:https://supernemo-dbd.github.io/Bayeux/" href="https://supernemo-dbd.github.io/Bayeux/classmctools_1_1simulated__data.html">mctools::simulated_data</a>&gt;(<span class="stringliteral">&quot;SD&quot;</span>);</div><div class="line">    simData.<a class="codeRef" doxygen="https://supernemo-dbd.github.io/Bayeux/bayeux.doxy.tag:https://supernemo-dbd.github.io/Bayeux/" href="https://supernemo-dbd.github.io/Bayeux/classmctools_1_1simulated__data.html#a6f6f950343809f722c590dba2d06e67d">tree_dump</a>();</div><div class="line"></div><div class="line">    <span class="keywordflow">return</span> falaise::processing::status::PROCESS_OK;</div><div class="line">  }</div><div class="line">};</div><div class="line"></div><div class="line"><a class="code" href="module_8h.html#a63c0e69cd4edd7150e04dd18e3de1358">FALAISE_REGISTER_MODULE</a>(AccessThingsModule)</div><div class="line"></div></div><!-- fragment --><p>We begin working with the event by simply printing its name and description. This is a trivial demonstration that the <a class="elRef" doxygen="https://supernemo-dbd.github.io/Bayeux/bayeux.doxy.tag:https://supernemo-dbd.github.io/Bayeux/" href="https://supernemo-dbd.github.io/Bayeux/classdatatools_1_1things.html">datatools::things</a> interface works, as for event data these are likely to be blank.</p>
<p>The second, more relevant task, is to extract the list of keys, and thus data banks, stored in the event. Here, we use the <code><a class="elRef" doxygen="https://supernemo-dbd.github.io/Bayeux/bayeux.doxy.tag:https://supernemo-dbd.github.io/Bayeux/" href="https://supernemo-dbd.github.io/Bayeux/classdatatools_1_1things.html#af252975ddd1438bac8ae045309ffd9ae">datatools::things::get_names</a></code> method to fill a <code>std::vector</code> with the key names. We then iterate over this vector to print out the key name and, by using the <code><a class="elRef" doxygen="https://supernemo-dbd.github.io/Bayeux/bayeux.doxy.tag:https://supernemo-dbd.github.io/Bayeux/" href="https://supernemo-dbd.github.io/Bayeux/classdatatools_1_1things.html#a24bb30e12f6537a13f573e1983327520">datatools::things::get_entry_serial_tag</a></code> method, typename of the object it maps to.</p>
<div class="fragment"><div class="line"><span class="comment">// Extract list of keys stored by the object</span></div><div class="line">std::vector&lt;std::string&gt; keys;</div><div class="line"><span class="keyword">event</span>.get_names(keys);</div><div class="line"></div><div class="line"><span class="comment">// Print each key and its concrete type</span></div><div class="line"><span class="keywordflow">for</span> (<span class="keyword">const</span> <span class="keyword">auto</span>&amp; k : keys) {</div><div class="line">  std::cout &lt;&lt; <span class="stringliteral">&quot;- [key, serial_tag] : &quot;</span></div><div class="line">      &lt;&lt; k</div><div class="line">      &lt;&lt; <span class="stringliteral">&quot;, &quot;</span></div><div class="line">      &lt;&lt; <span class="keyword">event</span>.get_entry_serial_tag(k)</div><div class="line">      &lt;&lt; std::endl;</div><div class="line">}</div></div><!-- fragment --><p>If we know the type of the key we wish to extract, we can use the <a class="elRef" doxygen="https://supernemo-dbd.github.io/Bayeux/bayeux.doxy.tag:https://supernemo-dbd.github.io/Bayeux/" href="https://supernemo-dbd.github.io/Bayeux/classdatatools_1_1things.html#a5b6aa9bc580a8228bfb3463d6e39268a">datatools::things::get</a> member function to obtain a const reference to it.</p>
<div class="fragment"><div class="line"><span class="keyword">auto</span>&amp; simData = <span class="keyword">event</span>.get&lt;<a class="codeRef" doxygen="https://supernemo-dbd.github.io/Bayeux/bayeux.doxy.tag:https://supernemo-dbd.github.io/Bayeux/" href="https://supernemo-dbd.github.io/Bayeux/classmctools_1_1simulated__data.html">mctools::simulated_data</a>&gt;(<span class="stringliteral">&quot;SD&quot;</span>);</div><div class="line">simData.<a class="codeRef" doxygen="https://supernemo-dbd.github.io/Bayeux/bayeux.doxy.tag:https://supernemo-dbd.github.io/Bayeux/" href="https://supernemo-dbd.github.io/Bayeux/classmctools_1_1simulated__data.html#a6f6f950343809f722c590dba2d06e67d">tree_dump</a>();</div></div><!-- fragment --><p>This member function takes a template argument which is the typename we want to extract, and a function argument which is the name of the key to get. In this case, we want to extract the "SD" ( <b>S</b> imulated <b>D</b> ata) bank and that this should be of type <a class="elRef" doxygen="https://supernemo-dbd.github.io/Bayeux/bayeux.doxy.tag:https://supernemo-dbd.github.io/Bayeux/" href="https://supernemo-dbd.github.io/Bayeux/classmctools_1_1simulated__data.html">mctools::simulated_data</a>. Use of <code>get</code> will throw an exception if either</p>
<ul>
<li>The key does not exist.</li>
<li>The key exists, but it does not map to the requested type</li>
</ul>
<p>with <code>flreconstruct</code> handling the exception and reporting to standard error.</p>
<p>Once extracted, the data can be used as required by your module. In this example, we simply use the <a class="elRef" doxygen="https://supernemo-dbd.github.io/Bayeux/bayeux.doxy.tag:https://supernemo-dbd.github.io/Bayeux/" href="https://supernemo-dbd.github.io/Bayeux/classmctools_1_1simulated__data.html#a6f6f950343809f722c590dba2d06e67d">mctools::simulated_data::tree_dump</a> member function to dump some information on the object to screen.</p>
<p>Finally, we return <a class="el" href="namespacefalaise_1_1processing.html#ae017f352999f7a267a0d3094b8573774">falaise::processing::status</a> to indicate that we've processed the event without error.</p>
<p>To see the reading of the data in action, we compile the above code into a shared library just as before using the following CMake script:</p>
<div class="fragment"><div class="line"><span class="preprocessor"># - Basic CMake setup</span></div><div class="line"><span class="preprocessor"># Check version meets ou requirements</span></div><div class="line"><span class="preprocessor"># Declare project, which will configure compiler for us</span></div><div class="line">cmake_minimum_required(VERSION 3.3)</div><div class="line">project(AccessThingsModule)</div><div class="line"></div><div class="line"><span class="preprocessor"># Modules use Falaise, so we need to locate this or fail</span></div><div class="line"><span class="preprocessor"># Locating Falaise will automatically locate all of its</span></div><div class="line"><span class="preprocessor"># dependencies such as Bayeux, ROOT and Boost.</span></div><div class="line">find_package(Falaise REQUIRED)</div><div class="line"></div><div class="line"><span class="preprocessor"># Build a dynamic library from our sources</span></div><div class="line">add_library(AccessThingsModule SHARED AccessThingsModule.cpp)</div><div class="line"></div><div class="line"><span class="preprocessor"># Link it to the FalaiseModule library</span></div><div class="line"><span class="preprocessor"># This ensures the correct compiler flags, include paths</span></div><div class="line"><span class="preprocessor"># and linker flags are applied to our dynamic library.</span></div><div class="line">target_link_libraries(AccessThingsModule PUBLIC Falaise::FalaiseModule)</div><div class="line"></div></div><!-- fragment --><p>and run <code>flreconstruct</code> with the following pipeline script:</p>
<div class="fragment"><div class="line">#@description AccessThings Pipeline</div><div class="line">#@key_label   &quot;name&quot;</div><div class="line">#@meta_label  &quot;type&quot;</div><div class="line"></div><div class="line"># - Custom modules</div><div class="line">[name=&quot;flreconstruct.plugins&quot; type=&quot;flreconstruct::section&quot;]</div><div class="line">plugins : string[1] = &quot;AccessThingsModule&quot;</div><div class="line">AccessThingsModule.directory : string = &quot;.&quot;</div><div class="line"></div><div class="line"># - Pipeline configuration</div><div class="line">[name=&quot;pipeline&quot; type=&quot;AccessThingsModule&quot;]</div><div class="line"></div></div><!-- fragment --><p>You should see output similar to the dump modules we ran in earlier tutorials.</p>
<h1><a class="anchor" id="things_writingdata"></a>
Writing Data to the Event </h1>
<p>As the <a class="elRef" doxygen="https://supernemo-dbd.github.io/Bayeux/bayeux.doxy.tag:https://supernemo-dbd.github.io/Bayeux/" href="https://supernemo-dbd.github.io/Bayeux/classdatatools_1_1things.html">datatools::things</a> instance is passed to pipeline modules by non-const reference, data can be both read from, and written to, it. This means your module can store results of working with the event back into the event for later modules to use (you can of course also delete existing data, so be careful!).</p>
<p>As <a class="elRef" doxygen="https://supernemo-dbd.github.io/Bayeux/bayeux.doxy.tag:https://supernemo-dbd.github.io/Bayeux/" href="https://supernemo-dbd.github.io/Bayeux/classdatatools_1_1things.html">datatools::things</a> can only store objects that inherit from the <a class="elRef" doxygen="https://supernemo-dbd.github.io/Bayeux/bayeux.doxy.tag:https://supernemo-dbd.github.io/Bayeux/" href="https://supernemo-dbd.github.io/Bayeux/classdatatools_1_1i__serializable.html">datatools::i_serializable</a> abstract base class, the types of data your module can add are restricted. For now we will just look at how to store an existing concrete class of <a class="elRef" doxygen="https://supernemo-dbd.github.io/Bayeux/bayeux.doxy.tag:https://supernemo-dbd.github.io/Bayeux/" href="https://supernemo-dbd.github.io/Bayeux/classdatatools_1_1i__serializable.html">datatools::i_serializable</a> in <a class="elRef" doxygen="https://supernemo-dbd.github.io/Bayeux/bayeux.doxy.tag:https://supernemo-dbd.github.io/Bayeux/" href="https://supernemo-dbd.github.io/Bayeux/classdatatools_1_1things.html">datatools::things</a>, specifically, the <a class="elRef" doxygen="https://supernemo-dbd.github.io/Bayeux/bayeux.doxy.tag:https://supernemo-dbd.github.io/Bayeux/" href="https://supernemo-dbd.github.io/Bayeux/classdatatools_1_1properties.html">datatools::properties</a> class. The use case of adding you own concrete classes of <a class="elRef" doxygen="https://supernemo-dbd.github.io/Bayeux/bayeux.doxy.tag:https://supernemo-dbd.github.io/Bayeux/" href="https://supernemo-dbd.github.io/Bayeux/classdatatools_1_1i__serializable.html">datatools::i_serializable</a> is deprecated, but a <a class="el" href="workingwitheventrecords.html#things_customdata">later tutorial in this guide covers the basics</a>.</p>
<p>We begin by refactoring the <code>process</code> method of our module into read and write parts:</p>
<div class="fragment"><div class="line"><span class="comment">// Interface from Falaise</span></div><div class="line"><span class="preprocessor">#include &quot;<a class="code" href="module_8h.html">falaise/snemo/processing/module.h</a>&quot;</span></div><div class="line"></div><div class="line"><span class="comment">// Any data models we need</span></div><div class="line"><span class="preprocessor">#include &lt;<a class="codeRef" doxygen="https://supernemo-dbd.github.io/Bayeux/bayeux.doxy.tag:https://supernemo-dbd.github.io/Bayeux/" href="https://supernemo-dbd.github.io/Bayeux/simulated__data_8h.html">bayeux/mctools/simulated_data.h</a>&gt;</span></div><div class="line"></div><div class="line"><span class="keyword">class </span>AccessThingsModule {</div><div class="line"> <span class="keyword">public</span>:</div><div class="line">  AccessThingsModule() = <span class="keywordflow">default</span>;</div><div class="line"></div><div class="line">  AccessThingsModule(<a class="code" href="classfalaise_1_1config_1_1property__set.html">falaise::config::property_set</a> <span class="keyword">const</span>&amp; <span class="comment">/*ps*/</span>,</div><div class="line">           <a class="codeRef" doxygen="https://supernemo-dbd.github.io/Bayeux/bayeux.doxy.tag:https://supernemo-dbd.github.io/Bayeux/" href="https://supernemo-dbd.github.io/Bayeux/classdatatools_1_1service__manager.html">datatools::service_manager</a>&amp; <span class="comment">/*services*/</span>) {</div><div class="line">  }</div><div class="line"></div><div class="line">  <span class="comment">// Process event</span></div><div class="line">  <a class="codeRef" doxygen="https://supernemo-dbd.github.io/Bayeux/bayeux.doxy.tag:https://supernemo-dbd.github.io/Bayeux/" href="https://supernemo-dbd.github.io/Bayeux/classdpp_1_1base__module.html#ae8431b8f4f2734bae557791b9f5417fb">falaise::processing::status</a> process(<a class="codeRef" doxygen="https://supernemo-dbd.github.io/Bayeux/bayeux.doxy.tag:https://supernemo-dbd.github.io/Bayeux/" href="https://supernemo-dbd.github.io/Bayeux/classdatatools_1_1things.html">datatools::things</a>&amp; event) {</div><div class="line">    std::cout &lt;&lt; <span class="stringliteral">&quot;AccessThingsModule::process called!&quot;</span> &lt;&lt; std::endl;</div><div class="line">    read(event);</div><div class="line">    write(event);</div><div class="line">    <span class="keywordflow">return</span> falaise::processing::status::PROCESS_OK;</div><div class="line">  }</div><div class="line"></div><div class="line"> <span class="keyword">private</span>:</div><div class="line">  <span class="comment">// read data</span></div><div class="line">  <span class="keywordtype">void</span> read(<a class="codeRef" doxygen="https://supernemo-dbd.github.io/Bayeux/bayeux.doxy.tag:https://supernemo-dbd.github.io/Bayeux/" href="https://supernemo-dbd.github.io/Bayeux/classdatatools_1_1things.html">datatools::things</a>&amp; event) {</div><div class="line">    <span class="comment">// Extract list of keys stored by the object</span></div><div class="line">    std::vector&lt;std::string&gt; keys;</div><div class="line">    <span class="keyword">event</span>.get_names(keys);</div><div class="line"></div><div class="line">    <span class="comment">// Print each key and its concrete type</span></div><div class="line">    <span class="keywordflow">for</span> (<span class="keyword">const</span> <span class="keyword">auto</span>&amp; k : keys) {</div><div class="line">      std::cout &lt;&lt; <span class="stringliteral">&quot;- [key, serial_tag] : &quot;</span></div><div class="line">          &lt;&lt; k</div><div class="line">          &lt;&lt; <span class="stringliteral">&quot;, &quot;</span></div><div class="line">          &lt;&lt; <span class="keyword">event</span>.get_entry_serial_tag(k)</div><div class="line">          &lt;&lt; std::endl;</div><div class="line">    }</div><div class="line">  }</div><div class="line"></div><div class="line">  <span class="comment">// write data</span></div><div class="line">  <span class="keywordtype">void</span> write(<a class="codeRef" doxygen="https://supernemo-dbd.github.io/Bayeux/bayeux.doxy.tag:https://supernemo-dbd.github.io/Bayeux/" href="https://supernemo-dbd.github.io/Bayeux/classdatatools_1_1things.html">datatools::things</a>&amp; event) {</div><div class="line">    <span class="comment">// Add a new data bank to the event</span></div><div class="line">    <span class="keyword">auto</span>&amp; atmProperties = <span class="keyword">event</span>.add&lt;<a class="codeRef" doxygen="https://supernemo-dbd.github.io/Bayeux/bayeux.doxy.tag:https://supernemo-dbd.github.io/Bayeux/" href="https://supernemo-dbd.github.io/Bayeux/classdatatools_1_1properties.html">datatools::properties</a>&gt;(<span class="stringliteral">&quot;ATMProperties&quot;</span>);</div><div class="line">    atmProperties.<a class="codeRef" doxygen="https://supernemo-dbd.github.io/Bayeux/bayeux.doxy.tag:https://supernemo-dbd.github.io/Bayeux/" href="https://supernemo-dbd.github.io/Bayeux/classdatatools_1_1properties.html#a7307aa9ac38ed78321effc896094fe48">set_description</a>(<span class="stringliteral">&quot;Properties added by the AccessThings Module&quot;</span>);</div><div class="line">    atmProperties.store(<span class="stringliteral">&quot;foo&quot;</span>, <span class="stringliteral">&quot;bar&quot;</span>);</div><div class="line">  }</div><div class="line">};</div><div class="line"></div><div class="line"><a class="code" href="module_8h.html#a63c0e69cd4edd7150e04dd18e3de1358">FALAISE_REGISTER_MODULE</a>(AccessThingsModule)</div><div class="line"></div></div><!-- fragment --><p>This separation is done for clarity in this example, but it illustrates that your <code>process</code> method need not be monolithic (and in fact shouldn't be except for trivial cases). The <code>read</code> member function just prints the held keys as we did before. In the <code>write</code> member function, we use <a class="elRef" doxygen="https://supernemo-dbd.github.io/Bayeux/bayeux.doxy.tag:https://supernemo-dbd.github.io/Bayeux/" href="https://supernemo-dbd.github.io/Bayeux/classdatatools_1_1things.html#a474a832f00612739dcb2a14f0e464301">datatools::things::add</a> to add new data bank to the event holding a <a class="elRef" doxygen="https://supernemo-dbd.github.io/Bayeux/bayeux.doxy.tag:https://supernemo-dbd.github.io/Bayeux/" href="https://supernemo-dbd.github.io/Bayeux/classdatatools_1_1properties.html">datatools::properties</a> instance. We pass this a template argument indicating the type of the data bank, and a string function argument indicating the key under which to store the new data bank. A reference to the newly created instance is returned so it can be modified in place, as we do by setting the description and adding two properties.</p>
<p>To see the effect of this writing, we compile the above code into a shared library just as before using the following CMake script:</p>
<div class="fragment"><div class="line"><span class="preprocessor"># - Basic CMake setup</span></div><div class="line"><span class="preprocessor"># Check version meets ou requirements</span></div><div class="line"><span class="preprocessor"># Declare project, which will configure compiler for us</span></div><div class="line">cmake_minimum_required(VERSION 3.3)</div><div class="line">project(AccessThingsModule)</div><div class="line"></div><div class="line"><span class="preprocessor"># Modules use Falaise, so we need to locate this or fail</span></div><div class="line"><span class="preprocessor"># Locating Falaise will automatically locate all of its</span></div><div class="line"><span class="preprocessor"># dependencies such as Bayeux, ROOT and Boost.</span></div><div class="line">find_package(Falaise REQUIRED)</div><div class="line"></div><div class="line"><span class="preprocessor"># Build a dynamic library from our sources</span></div><div class="line">add_library(AccessThingsModule SHARED AccessThingsModule.cpp)</div><div class="line"></div><div class="line"><span class="preprocessor"># Link it to the FalaiseModule library</span></div><div class="line"><span class="preprocessor"># This ensures the correct compiler flags, include paths</span></div><div class="line"><span class="preprocessor"># and linker flags are applied to our dynamic library.</span></div><div class="line">target_link_libraries(AccessThingsModule PUBLIC Falaise::FalaiseModule)</div><div class="line"></div></div><!-- fragment --><p>To see the effect of the writing new banks into the event, we use a pipeline script to sandwich the module between two dump modules as follows</p>
<div class="fragment"><div class="line">#@description AccessThings Pipeline</div><div class="line">#@key_label   &quot;name&quot;</div><div class="line">#@meta_label  &quot;type&quot;</div><div class="line"></div><div class="line"># - Custom modules</div><div class="line">[name=&quot;flreconstruct.plugins&quot; type=&quot;flreconstruct::section&quot;]</div><div class="line">plugins : string[1] = &quot;AccessThingsModule&quot;</div><div class="line">AccessThingsModule.directory : string = &quot;.&quot;</div><div class="line"></div><div class="line"># - Pipeline configuration</div><div class="line">[name=&quot;pipeline&quot; type=&quot;dpp::chain_module&quot;]</div><div class="line">modules : string[3] = &quot;preprocess&quot; &quot;access_things&quot; &quot;postprocess&quot;</div><div class="line"></div><div class="line">[name=&quot;preprocess&quot; type=&quot;dpp::dump_module&quot;]</div><div class="line">title : string = &quot;PreProcess&quot;</div><div class="line"></div><div class="line">[name=&quot;postprocess&quot; type=&quot;dpp::dump_module&quot;]</div><div class="line">title : string = &quot;PostProcess&quot;</div><div class="line"></div><div class="line">[name=&quot;access_things&quot; type=&quot;AccessThingsModule&quot;]</div><div class="line"></div></div><!-- fragment --><p>You should see that the <code>PostProcess</code> stage results in output containing the information written into the <code>ATMProperties</code> bank.</p>
<h1><a class="anchor" id="things_customdata"></a>
Implementing Custom Objects for Storage in datatools::things </h1>
<p><b>Please note that this section is now deprecated as Falaise is migrating to a full <a href="https://root.cern.ch">ROOT</a>-based serialization system. During this migration phase, requests for new data types must be made via <a href="https:/github.com/supernemo-dbd/Falaise/issues">Issues on Falaise's GitHub</a>. The legacy documentation may be consulted online.</b> </p>
</div></div><!-- PageDoc -->
</div><!-- contents -->
<!-- start footer part -->
<hr class="footer"/><address class="footer"><small>
Generated by &#160;<a href="http://www.doxygen.org/index.html">
<img class="footer" src="doxygen.png" alt="doxygen"/>
</a> 1.8.15
</small></address>
</body>
</html>
