<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.13"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>Falaise: Writing FLReconstruct Pipeline Scripts</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectalign" style="padding-left: 0.5em;">
   <div id="projectname">Falaise
   &#160;<span id="projectnumber">3.1.0</span>
   </div>
   <div id="projectbrief">SuperNEMO Software Toolkit</div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.13 -->
<script type="text/javascript">
var searchBox = new SearchBox("searchBox", "search",false,'Search');
</script>
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
$(function() {
  initMenu('',true,false,'search.php','Search');
  $(document).ready(function() { init_search(); });
});
</script>
<div id="main-nav"></div>
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

</div><!-- top -->
<div class="header">
  <div class="headertitle">
<div class="title">Writing FLReconstruct Pipeline Scripts </div>  </div>
</div><!--header-->
<div class="contents">
<div class="toc"><h3>Table of Contents</h3>
<ul><li class="level1"><a href="#wflrps_intro">Introduction to FLReconstruct Pipeline Scripts </a></li>
<li class="level1"><a href="#wflrps_discoveringavailablemodules">Discovering Available Modules </a></li>
<li class="level1"><a href="#wflrps_implementing_pipeline_scripts">Implementing Pipeline Scripts </a><ul><li class="level2"><a href="#trivial_pipeline">Trivial Pipeline </a></li>
<li class="level2"><a href="#wflrps_chain_pipeline">Creating a Chained Pipeline </a></li>
<li class="level2"><a href="#wflrps_multi_pipeline">Multi-Module Pipeline </a></li>
</ul>
</li>
<li class="level1"><a href="#wflrps_pluginmodules">Using Plugin Modules </a></li>
<li class="level1"><a href="#further">Going Further </a></li>
</ul>
</div>
<div class="textblock"><h1><a class="anchor" id="wflrps_intro"></a>
Introduction to FLReconstruct Pipeline Scripts </h1>
<p>Though Falaise supplies a set of pipelines for standard reconstruction, it is also possible write your own custom pipeline scripts for use in <code>flreconstruct</code>. These are nothing more than text files marked up using the <code><a class="elRef" doxygen="https://supernemo-dbd.github.io/Bayeux/bayeux.doxy.tag:https://supernemo-dbd.github.io/Bayeux/" href="https://supernemo-dbd.github.io/Bayeux/classdatatools_1_1multi__properties.html">datatools::multi_properties</a></code> syntax. Custom pipeline scripts can be run in <code>flreconstruct</code> by passing their path to the <code>-p</code> (or <code>--pipeline</code>) command, for example</p>
<div class="fragment"><div class="line">$ flreconstruct -i example.brio -p myscript.conf</div></div><!-- fragment --><p>or</p>
<div class="fragment"><div class="line">$ flreconstruct -i example.brio -p /home/me/myscript.conf</div></div><!-- fragment --><p>The major use cases for custom pipelines are to study performance improvements to the current pipelines by tuning parameters or implementing new modules. Here we cover the task of writing a script to build a custom pipeline from the standard modules supplied with Falaise. The more advanced step of writing and using new modules is covered in the <a class="el" href="writingflreconstructmodules.html">Writing FLReconstruct Modules</a> section.</p>
<h1><a class="anchor" id="wflrps_discoveringavailablemodules"></a>
Discovering Available Modules </h1>
<p>A list of pipeline modules known to <code>flreconstruct</code> can be obtained using its <code>--help-module-list</code> argument, which will print the module names to stdout:</p>
<div class="fragment"><div class="line">$ flreconstruct --help-module-list</div><div class="line">Things2Root</div><div class="line">bipo3::processing::calorimeter_s2c_module</div><div class="line">dpp::chain_module</div><div class="line">dpp::dummy_module</div><div class="line">dpp::dump_module</div><div class="line">dpp::if_module</div><div class="line">dpp::input_module</div><div class="line">dpp::output_module</div><div class="line">dpp::skip_module</div><div class="line">dpp::utils_module</div><div class="line">mctools::simulated_data_input_module</div><div class="line">snemo::processing::event_header_utils_module</div><div class="line">snemo::processing::mock_calorimeter_s2c_module</div><div class="line">snemo::processing::mock_tracker_s2c_module</div><div class="line">snemo::reconstruction::cat_tracker_clustering_module</div><div class="line">snemo::reconstruction::charged_particle_tracking_module</div><div class="line">snemo::reconstruction::mock_tracker_clustering_module</div><div class="line">snemo::reconstruction::sultan_tracker_clustering_module</div><div class="line">snemo::reconstruction::trackfit_tracker_fitting_module</div><div class="line">snemo::visualization::visu_toy_module</div></div><!-- fragment --><p>Details about the purpose of a module and the parameters you can supply to configure it may be obtained by passing the module name as the argument of the <code>--help-module</code> command. This will print out detailed documentation, if it exists:</p>
<div class="fragment"><div class="line">$ flreconstruct --help-module dpp::chain_module</div><div class="line"></div><div class="line">======================================</div><div class="line">Configuration of ``dpp::chain_module``</div><div class="line">======================================</div><div class="line"></div><div class="line">... further detailed output ...</div></div><!-- fragment --><p>This information can be used to select suitable modules and configurations for your own pipeline. The following sections provide some simple examples of pipeline scripts.</p>
<h1><a class="anchor" id="wflrps_implementing_pipeline_scripts"></a>
Implementing Pipeline Scripts </h1>
<p>To demonstrate the basic syntax and structure of an <code>flreconstruct</code> pipeline script, the following sections build up functionality from single modules up to using a chain of plugin modules.</p>
<h2><a class="anchor" id="trivial_pipeline"></a>
Trivial Pipeline </h2>
<p>If you do not supply a pipeline script to <code>flreconstruct</code>, it will run a dumb pipeline that simple dumps each event to stdout.</p>
<p>We can reproduce this behaviour using the following simple script to configure the pipeline as a single module:</p>
<div class="fragment"><div class="line"># *MUST* define description, key_label and meta_label labels</div><div class="line"># The latter two *MUST* be named &quot;name&quot; and &quot;type&quot;</div><div class="line"># Note that lines beginning with &#39;#&#39; are comments, *except* for lines</div><div class="line"># beginning &#39;#@&#39; which are labels...</div><div class="line"></div><div class="line">#@description Simple pipeline of one module that dumps each event to cout</div><div class="line">#@key_label   &quot;name&quot;</div><div class="line">#@meta_label  &quot;type&quot;</div><div class="line"></div><div class="line"># # Basic section</div><div class="line"># [name=&quot;flreconstruct&quot; type=&quot;flreconstruct::section&quot;]</div><div class="line"># experimentalSetupUrn : string = &quot;urn:snemo:demonstrator:setup:1.0&quot;</div><div class="line"></div><div class="line"># # Variant service section</div><div class="line"># [name=&quot;flreconstruct.variantService&quot; type=&quot;flreconstruct::section&quot;]</div><div class="line"># profile : string as path = &quot;vprofile.conf&quot;</div><div class="line"></div><div class="line"># Must define &quot;pipeline&quot; as this is the module flreconstruct will use</div><div class="line">[name=&quot;pipeline&quot; type=&quot;dpp::dump_module&quot;]</div><div class="line">output : string = &quot;cout&quot;</div></div><!-- fragment --><p>The script is formatted as a <code><a class="elRef" doxygen="https://supernemo-dbd.github.io/Bayeux/bayeux.doxy.tag:https://supernemo-dbd.github.io/Bayeux/" href="https://supernemo-dbd.github.io/Bayeux/classdatatools_1_1multi__properties.html">datatools::multi_properties</a></code> ASCII file. Note the comments, especially:</p>
<ul>
<li>The required presence of the <code>@key_label</code> and <code>@meta_label</code> multi_properties flags</li>
<li>The module constituting the pipeline must have the <code>name</code> key set to <code>pipeline</code>. FLReconstruct will use this to build the pipeline.</li>
</ul>
<p>To try this out, copy the above text into a file, e.g. <code>trivial_pipeline.txt</code> and run <code>flreconstruct</code> with it:</p>
<div class="fragment"><div class="line">$ flreconstruct -i example.brio -p trivial_pipeline.txt</div></div><!-- fragment --><p>You should see the same output as the default case.</p>
<h2><a class="anchor" id="wflrps_chain_pipeline"></a>
Creating a Chained Pipeline </h2>
<p>A pipeline with one module isn't very useful! In most cases we want to plug together a sequence of modules, each performing a well defined task on the event data.</p>
<p>Falaise supplies a special <code>chain_module</code> for chaining several modules together. We can reproduce the same default dump behaviour using a <code>chain_module</code> in a pipeline script as follows</p>
<div class="fragment"><div class="line"># *MUST* define description, key_label and meta_label labels</div><div class="line"># The latter two *MUST* be named &quot;name&quot; and &quot;type&quot;</div><div class="line"># Note that lines beginning with &#39;#&#39; are comments, *except* for lines</div><div class="line"># beginning &#39;#@&#39; which are labels...</div><div class="line"></div><div class="line">#@description Simple pipeline using a chain module with one link</div><div class="line">#@key_label   &quot;name&quot;</div><div class="line">#@meta_label  &quot;type&quot;</div><div class="line"></div><div class="line"># # Basic section</div><div class="line"># [name=&quot;flreconstruct&quot; type=&quot;flreconstruct::section&quot;]</div><div class="line"># experimentalSetupUrn : string = &quot;urn:snemo:demonstrator:setup:1.0&quot;</div><div class="line"></div><div class="line"># # Variant service section</div><div class="line"># [name=&quot;flreconstruct.variantService&quot; type=&quot;flreconstruct::section&quot;]</div><div class="line"># profile : string as path = &quot;vprofile.conf&quot;</div><div class="line"></div><div class="line"># Must define &quot;pipeline&quot; as this is the module flreconstruct will use</div><div class="line">[name=&quot;pipeline&quot; type=&quot;dpp::chain_module&quot;]</div><div class="line"># &#39;modules&#39; key is a list of module names that will be chained together in</div><div class="line"># the given sequence</div><div class="line">modules : string[1] = &quot;my_dump&quot;</div><div class="line"></div><div class="line"># Define the &quot;my_dump&quot; module as a simple dump module which is configured</div><div class="line"># exactly like we did in the simplepipeline example</div><div class="line">[name=&quot;my_dump&quot; type=&quot;dpp::dump_module&quot;]</div><div class="line">output : string = &quot;cout&quot;</div></div><!-- fragment --><p>Here, the <code>modules</code> key of the <code>pipeline</code> module takes a list of modules that will form the <code>chain_module</code>. To try this out, copy the above text into a file, e.g. <code>single_chain_pipeline.txt</code> and run <code>flreconstruct</code> with it:</p>
<div class="fragment"><div class="line">$ flreconstruct -i example.brio -p single_chain_pipeline.txt</div></div><!-- fragment --><p>You should see the same output as the default case.</p>
<h2><a class="anchor" id="wflrps_multi_pipeline"></a>
Multi-Module Pipeline </h2>
<p>A full chain pipeline can chain together 1 &lt; N &lt; X number of modules. The previous example showed the basic construct of a chained pipeline with a single module. We can of course go further and add further module to the pipeline. For example, we can chain two dump modules together. To distinguish these, we configure the modules to have different <code>title</code> and <code>indent</code> parameters.</p>
<div class="fragment"><div class="line"># *MUST* define description, key_label and meta_label labels</div><div class="line"># The latter two *MUST* be named &quot;name&quot; and &quot;type&quot;</div><div class="line"># Note that lines beginning with &#39;#&#39; are comments, *except* for lines</div><div class="line"># beginning &#39;#@&#39; which are labels...</div><div class="line"></div><div class="line">#@description Simple pipeline using a chain module with one link</div><div class="line">#@key_label   &quot;name&quot;</div><div class="line">#@meta_label  &quot;type&quot;</div><div class="line"></div><div class="line"># # Basic section</div><div class="line"># [name=&quot;flreconstruct&quot; type=&quot;flreconstruct::section&quot;]</div><div class="line"># experimentalSetupUrn : string = &quot;urn:snemo:demonstrator:setup:1.0&quot;</div><div class="line"></div><div class="line"># # Variant service section</div><div class="line"># [name=&quot;flreconstruct.variantService&quot; type=&quot;flreconstruct::section&quot;]</div><div class="line"># profile : string as path = &quot;vprofile.conf&quot;</div><div class="line"></div><div class="line"># Must define &quot;pipeline&quot; as this is the module flreconstruct will use</div><div class="line">[name=&quot;pipeline&quot; type=&quot;dpp::chain_module&quot;]</div><div class="line"># &#39;modules&#39; key is a list of module names that will be chained together in</div><div class="line"># the given sequence</div><div class="line">modules : string[2] = &quot;first&quot; &quot;second&quot;</div><div class="line"></div><div class="line"># Define the &quot;first&quot; module as a simple dump module which is configured</div><div class="line"># with some specific formatting</div><div class="line">[name=&quot;first&quot; type=&quot;dpp::dump_module&quot;]</div><div class="line">output : string = &quot;cout&quot;</div><div class="line">title  : string = &quot;FirstModule&quot;</div><div class="line"></div><div class="line"># Define the &quot;second&quot; module as a simple dump module which is configured</div><div class="line"># with some fancier formatting so we can see the difference from the first</div><div class="line">[name=&quot;second&quot; type=&quot;dpp::dump_module&quot;]</div><div class="line">output : string = &quot;cout&quot;</div><div class="line">title  : string = &quot;SecondModule&quot;</div><div class="line">indent : string = &quot;  &quot;</div></div><!-- fragment --><p>The order in which the modules are processed is determined by the order in which you list them in the <code>modules</code> key of the <code><a class="elRef" doxygen="https://supernemo-dbd.github.io/Bayeux/bayeux.doxy.tag:https://supernemo-dbd.github.io/Bayeux/" href="https://supernemo-dbd.github.io/Bayeux/classdpp_1_1chain__module.html">dpp::chain_module</a></code> configuration.</p>
<p>To try this out, copy the above text into a file, e.g. <code>multi_chain_pipeline.txt</code> and run <code>flreconstruct</code> with it:</p>
<div class="fragment"><div class="line">$ flreconstruct -i example.brio -p multi_chain_pipeline.txt</div></div><!-- fragment --><p>Try swapping the order of the modules to see what happens, and also try adding further dump modules to the pipeline to experiment with the sequence.</p>
<h1><a class="anchor" id="wflrps_pluginmodules"></a>
Using Plugin Modules </h1>
<p>Falaise supplies several modules as plugins, that is, functionality loaded into <code>flreconstruct</code> after it starts running.</p>
<h1><a class="anchor" id="further"></a>
Going Further </h1>
<p>You can also write your own modules in C++ and plug them into the pipeline to provide additional functionality. The proceedure for writing and using new modules is covered in several stages, beginning with a <a class="el" href="writingflreconstructmodules.html">simple example</a>. </p>
</div></div><!-- contents -->
<!-- start footer part -->
<hr class="footer"/><address class="footer"><small>
Generated by &#160;<a href="http://www.doxygen.org/index.html">
<img class="footer" src="doxygen.png" alt="doxygen"/>
</a> 1.8.13
</small></address>
</body>
</html>
